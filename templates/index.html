{% extends 'base.html' %}

{% block content %}
<div class="dashboard-layout">

    <div class="hero-section">
        <h1 class="hero-title">Centro de Comando</h1>
        <p class="hero-subtitle">Plataforma de comunicaciones encriptada y distribuida.</p>

        <div style="margin-top: 20px; display: flex; align-items: center; gap: 20px;">
            <div class="user-mini-profile" style="background: var(--bg-surface); padding: 10px 20px; border: 1px solid var(--border-light);">
                <img src="{{ user.avatar_url }}" style="width: 32px; height: 32px; border-radius: 50%; margin-right: 10px;">
                <span style="font-weight: 600;">{{ user.username }}</span>
                <span style="color: var(--accent-status-online); margin-left: 10px;">● Online</span>
            </div>
            {% if es_admin %}
            <span class="room-card-badge" style="background: #331111; color: #ef4444; border-color: #551111;">ADMINISTRADOR</span>
            {% endif %}
            <a href="{{ url_for('logout') }}" class="btn">Cerrar Sesión</a>
        </div>
    </div>

    <div class="flex justify-between items-center" style="margin-bottom: 20px;">
        <h2 class="auth-title" style="font-size: 1.2rem;">SALAS DE OPERACIONES</h2>
        {% if es_admin %}
        <button class="btn btn-primary" onclick="toggleAdminPanel()">+ Nueva Sala</button>
        {% endif %}
    </div>

    {% if es_admin %}
    <div id="adminPanel" class="hidden" style="background: var(--bg-surface); padding: 20px; border-radius: 8px; border: 1px solid var(--border-light); margin-bottom: 30px;">
        <form action="{{ url_for('create_room') }}" method="POST" class="flex flex-col gap-4">
            <div class="flex gap-4">
                <input type="text" name="nombre" placeholder="Nombre Clave (Ej: Sector 7)" required style="flex: 1;">
                <select name="geo" style="width: 150px;">
                    <option value="local">LOCAL</option>
                    <option value="regional">REGIONAL</option>
                    <option value="global">GLOBAL</option>
                </select>
            </div>
            <input type="text" name="descripcion" placeholder="Descripción de la misión..." required>
            <div class="flex justify-between">
                <button type="button" class="btn" onclick="toggleAdminPanel()">Cancelar</button>
                <button type="submit" class="btn btn-primary">Inicializar Sala</button>
            </div>
        </form>
    </div>
    {% endif %}

    <div class="rooms-grid">
        {% for sala in salas %}
        <div class="room-card" onclick="location.href='/chat/{{ sala.id }}'">
            <div>
                <div class="flex justify-between items-center" style="margin-bottom: 10px;">
                    <h3 class="room-card-title">{{ sala.nombre }}</h3>
                    <span class="room-card-badge">{{ sala.geo }}</span>
                </div>
                <p class="room-card-desc">{{ sala.descripcion }}</p>
            </div>
            <div class="room-enter-arrow">→</div>
        </div>
        {% endfor %}
    </div>

</div>

<script>
    function toggleAdminPanel() {
        document.getElementById('adminPanel').classList.toggle('hidden');
    }
</script>
{% endblock %}